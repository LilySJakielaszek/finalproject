---
title: "FinalProjectData"
authors: "Lily Jakielaszek, Allison Denenberg, Ayoolwatomiwa Ogunrombi"
output: html_notebook
---

### Load the Libraries and Datasets
```{r}
# front matter
rm(list = ls())
library(DataComputing)
library(lubridate)
library(tidyverse)
library(rvest)
library(mosaic)
OccupationProjection <- read.csv("https://query.data.world/s/hfgf3loqzzbk34aytghvne5sxg3ljr", header=TRUE, stringsAsFactors=FALSE);

OccupationProjection<-OccupationProjection%>%
  filter(Occupation.Name!="Total, All Occupations")

salaries_by_region = readr::read_csv("salaries-by-region.csv")

salaries_by_college_type = readr::read_csv("salaries-by-college-type.csv")

degrees_that_pay_back = readr::read_csv("degrees-that-pay-back.csv")
```
# Research Question

What school, major, and occupation should a prospective college student choose (what is the game plan)?

## Make New Datasets

These datasets will be the ones that will be used to perform statistics on and joins on. They are renamed from the original datasets and include all the same information except they have R acceptable variable names and the correct type for the their output. 

```{r}
SalariesByRegion <-
  salaries_by_region %>%
  mutate(School_Name = `School Name`,
         Mid_Career_Median_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career Median Salary`)),
         Starting_Median_Salary = as.numeric(gsub('\\$|,', '', `Starting Median Salary`)),
         Mid_Career_10th_Percentile_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career 10th Percentile Salary`)),
         Mid_Career_25th_Percentile_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career 25th Percentile Salary`)),
         Mid_Career_75th_Percentile_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career 75th Percentile Salary`)),
         Mid_Career_90th_Percentile_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career 90th Percentile Salary`)),
         Difference = Mid_Career_Median_Salary - Starting_Median_Salary) 
SalariesByRegion <- 
  SalariesByRegion %>%
  select(School_Name, Region, Mid_Career_Median_Salary, Starting_Median_Salary, Mid_Career_10th_Percentile_Salary, Mid_Career_25th_Percentile_Salary, Mid_Career_75th_Percentile_Salary, Mid_Career_90th_Percentile_Salary, Difference)
SalariesByRegion
```
```{r}
SalariesByCollegeType <-
  salaries_by_college_type %>%
  mutate(School_Name = `School Name`,
         School_Type = `School Type`,
         Mid_Career_Median_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career Median Salary`)),
         Starting_Median_Salary = as.numeric(gsub('\\$|,', '', `Starting Median Salary`)),
         Mid_Career_10th_Percentile_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career 10th Percentile Salary`)),
         Mid_Career_25th_Percentile_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career 25th Percentile Salary`)),
         Mid_Career_75th_Percentile_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career 75th Percentile Salary`)),
         Mid_Career_90th_Percentile_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career 90th Percentile Salary`)),
         Difference = Mid_Career_Median_Salary - Starting_Median_Salary)
SalariesByCollegeType <-
  SalariesByCollegeType %>%
  select(School_Name, School_Type, Starting_Median_Salary, Mid_Career_Median_Salary, Mid_Career_10th_Percentile_Salary, Mid_Career_25th_Percentile_Salary, Mid_Career_75th_Percentile_Salary, Mid_Career_90th_Percentile_Salary, Difference)
SalariesByCollegeType
```

```{r}
DegreesThatPayBack <-
  degrees_that_pay_back %>%
  mutate(Undergraduate_Major = `Undergraduate Major`,
         Mid_Career_Median_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career Median Salary`)),
         Starting_Median_Salary = as.numeric(gsub('\\$|,', '', `Starting Median Salary`)),
         Mid_Career_10th_Percentile_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career 10th Percentile Salary`)),
         Mid_Career_25th_Percentile_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career 25th Percentile Salary`)),
         Mid_Career_75th_Percentile_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career 75th Percentile Salary`)),
         Mid_Career_90th_Percentile_Salary = as.numeric(gsub('\\$|,', '', `Mid-Career 90th Percentile Salary`)),
         Percent_Change_From_Starting_To_MidCareer_Salary = `Percent change from Starting to Mid-Career Salary`,
         Difference = Mid_Career_Median_Salary - Starting_Median_Salary)
DegreesThatPayBack <-
  DegreesThatPayBack %>%
  select(Undergraduate_Major, Starting_Median_Salary, Mid_Career_Median_Salary, Mid_Career_10th_Percentile_Salary, Mid_Career_25th_Percentile_Salary, Mid_Career_75th_Percentile_Salary, Mid_Career_90th_Percentile_Salary, Percent_Change_From_Starting_To_MidCareer_Salary, Difference)
DegreesThatPayBack
```
```{r}
OccupationsProjection <-
  OccupationProjection %>%
  mutate(State_FIPS = State.FIPS,
         Region = Area.Name,
         Occupation_Code = Occupation.Code,
         Occupation_Name = Occupation.Name,
         Base_Year = Base.Year,
         Base = Base,
         Projected_Year = Projected.Year,
         Projection= Projection,
         Percent_Change = Percent.Change,
         Average_Annual_Openings = Average.Annual.Openings) 
OccupationsProjection <-
  OccupationsProjection %>%
  select(State_FIPS, Region, Occupation_Code, Occupation_Name, Base_Year, Base, Projected_Year, Projection, Percent_Change, Average_Annual_Openings) 
OccupationsProjection
```
### Inspecting the Revised Datasets 
## OccupationProjection Inspection
```{r}
str(OccupationProjection)
head(OccupationProjection)
tail(OccupationProjection)
nrow(OccupationProjection)
```

## DegreesThatPayBack Inspection
```{r}
str(DegreesThatPayBack)
head(DegreesThatPayBack)
tail(DegreesThatPayBack)
nrow(DegreesThatPayBack)
```

## SalariesByCollegeType Inspection
```{r}
str(SalariesByCollegeType)
head(SalariesByCollegeType)
tail(SalariesByCollegeType)
nrow(SalariesByCollegeType)
```

## SalariesByRegion Inspection
```{r}
str(SalariesByRegion)
head(SalariesByRegion)
tail(SalariesByRegion)
nrow(SalariesByRegion)
```

### First Step in Game Plan: Find the Schools with the Highest Salaries

Join the datasets together to match up the school names. 
```{r}
SchoolSalaries <-
  SalariesByCollegeType %>%
  full_join(SalariesByRegion)
head(SchoolSalaries)
```

Now we will observe the top ten schools with the highest starting median salaries 
```{r}
SchoolSalaries %>%
  select(School_Name, School_Type, Region, Starting_Median_Salary) %>%
  arrange(desc(Starting_Median_Salary)) %>% 
  head(10)
```

Now we will find the top ten schools with the highest mid-career median salaries 
```{r}
SchoolSalaries %>%
  select(School_Name, School_Type, Region, Mid_Career_Median_Salary) %>%
  arrange(desc(Mid_Career_Median_Salary)) %>% 
  head(10)
```
At this point we can see that California and NorthEastern schools are in the top ten consistenly. We can also see that the top school types are Ivy League and Engineering schools. 

Now we will combine these results to find the best school for percent change from starting to mid-career median salary which will show the best school for salary growth over time
```{r}
percentChange <-
  SchoolSalaries %>%
  mutate(Percent_Change = ((Mid_Career_Median_Salary - Starting_Median_Salary)/Starting_Median_Salary) * 100) %>%
  select(School_Name, School_Type, Percent_Change) %>%
  arrange(desc(Percent_Change)) %>%
  head(50)
percentChange
```

## Visualizations on Schools and Salaries 

```{r}
SchoolSalariesGraphic <-
  percentChange%>%
  ggplot(aes(x = reorder(School_Name, -Percent_Change), y = Percent_Change, color = School_Type)) + 
  geom_point() +
  xlab("School Name") +
  ylab("Percent Change") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

SchoolSalariesGraphic

```


### Conclusions on Schools and Salaries 

We can conclude that the school to pick if you want the highest starting median salary is California Institute of Technology (CIT) with a salary amount of $75,500, the school to pick if you want the highest mid-career median salary is Dartmouth College with a salary amount of $134,000, and the school to pick if you want the best salary growth over time is DartMouth College with a salary percent growth from starting to mid-career median salary of 131.0345%. 

# Second Step in Game Plan: Finding the Majors with the Highest Salaries 

We will be using the DegreesThatPayBack dataset to answer this part of the game plan

First we will look at the top ten majors with the best starting median salary

```{r}
head(DegreesThatPayBack)
DegreesThatPayBack %>%
  select(Undergraduate_Major, Starting_Median_Salary) %>%
  arrange(desc(Starting_Median_Salary)) %>%
  head(10)
```
From this we can see that the best major for starting median salary is a Physician Assistant

Now we will look at the top ten majors with the best mid-career median salary
```{r}
DegreesThatPayBack %>%
  select(Undergraduate_Major, Mid_Career_Median_Salary) %>%
  arrange(desc(Mid_Career_Median_Salary)) %>%
  head(10)
```
From this we can see that the best major for mid-career median salary is Chemical Engineering

Now we will look at the top ten majors with the best percentage change from starting to mid-career median salary to see which major offers the best growth in salary
```{r}
DegreesThatPayBack <-
  DegreesThatPayBack%>%
  select(Undergraduate_Major, Percent_Change_From_Starting_To_MidCareer_Salary) %>%
  arrange(desc(Percent_Change_From_Starting_To_MidCareer_Salary)) %>%
  head(50)
DegreesThatPayBack
```
From this we can see that Math is best major for average salary growth 

## Visualization of Majors and Salaries

```{r}
DegreesThatPayBack %>%
  ggplot(aes(x = reorder(Undergraduate_Major, -Percent_Change_From_Starting_To_MidCareer_Salary), y = Percent_Change_From_Starting_To_MidCareer_Salary)) +
  geom_bar(stat = "identity") +
  xlab("Undergraduate Major") +
  ylab("Percent Change: Starting to Mid-Career Salary")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```


### Conclusions of Majors and Salaries

With these results we can conclude that the best major if you want the highest starting median salary is Physician Assistant at $74,300, the best major if you want the highest mid-career median salary is Chemical Engineering	at $107,000, and the best major for greatest percent growth from starting to mid-career median salary is Math at 103.5%.

# Third Step in Game Plan: Finding the Occupations with the Highest Salaries and Job Security 

We will be using the OccupationSalaries dataset which we found on a website online for the evaluation of this step in the game plan

First we will extract the table from the website online
```{r}
web_page<-"https://www.bls.gov/oes/current/oes_nat.htm#00-0000"
ListofTables<- web_page%>%
  read_html()%>%
  html_nodes(css= "table")%>%
  html_table(fill=TRUE)

```

Next, we will use data scraping to get the data ready for analysis
```{r}
head(ListofTables[[2]])
OccupationSalaries<-ListofTables[[2]]
OccupationSalaries<-OccupationSalaries%>%
  filter(row_number()>2)%>%
   rename(Code=`Occupation code`,
          Name=`Occupation title (click on the occupation title to view its profile)`,
          Level=Level,
          Employment=Employment,
          RSE=`Employment RSE`,
          EP1J=`Employment per 1,000 jobs`,
          Median=`Median hourly wage`,
          Mean=`Mean hourly wage`,
          Annual=`Annual mean wage`,
          WRSE=`Mean wage RSE`)
str(OccupationSalaries)
OccupationSalaries<-OccupationSalaries%>%
  mutate(Employment=gsub(pattern=',',replacement='',Employment),RSE=gsub(pattern='%',replacement='',RSE),Median=gsub(pattern='\\$',replacement='',Median),Mean=gsub(pattern='\\$',replacement='',Mean),Annual=gsub(pattern='\\$|,',replacement='',Annual),WRSE=gsub(pattern='%',replacement='',WRSE))

OccupationSalaries<-OccupationSalaries%>%
  mutate(Employment=as.numeric(Employment),RSE=as.numeric(RSE),EP1J=as.numeric(EP1J),Median=as.numeric(Median),Mean=as.numeric(Mean),Annual=as.numeric(Annual),WRSE=as.numeric(WRSE))
str(OccupationSalaries)
OccupationSalaries<-na.omit(OccupationSalaries)
OccupationSalaries
```

Now we will join the OccupationSalaries dataset to the OccupationProjection dataset so that we can make a full analysis on Occupations

```{r}
Occupation_Proj_Salary<-OccupationsProjection%>%
  rename(Name=Occupation_Name, Code=Occupation_Code)%>%
  full_join(OccupationSalaries)
Occupation_Proj_Salary<-na.omit(Occupation_Proj_Salary)
Occupation_Proj_Salary
```

### Finding Occupations with the best job security
```{r}
Occupation_Proj_Salary%>%
  filter(EP1J>15, Percent_Change>10,Average_Annual_Openings>1000)%>%
  arrange(desc(Percent_Change))%>%
  group_by(Name)%>%
  summarise(Average_Annual_Openings=sum(Average_Annual_Openings))%>%
  arrange(desc(Average_Annual_Openings))%>%
  head()
  
  
  
  
```

In the above analysis we tried to find the jobs that have the best security. We defined security as having a high upward change in job creation, a high average annual job opening and a high EP1J (Employment per 1000 jobs). As an arbitrary value for high we decided on an EP1J of greater than 15, A annual job openings of greater than 1000 and a high upward change in job creation of greater than 10%. We Thus filtered these jobs out of the data-set and the 6 jobs with the highest security are Registered nurses, Retail Salespersons, Customer Service Representatives, Laborers and Freight and General and Operations Managers. These jobs are not however, the best in terms of Salary. This is what we will analyse next.

### Finding jobs with the highest Salaries
```{r}
Occupation_Proj_Salary%>%
  arrange(desc(Annual))%>%
  group_by(Name)%>%
  summarise(AnnualSalary=sum(Annual))%>%
  arrange(desc(AnnualSalary))%>%
  head()
  
```

From the above analysis, it is clear that the jobs with the highest salaries include, Chief Executives, Dentists, Nurse Anesthetists, Computer and Information Systems Managers, Financial Managers and Architectural and Engineering Managers.

From this analysis it is clear that the jobs that provide the highest job security do not provide the best security financially. 
